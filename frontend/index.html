<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeetCode Tutor</title>
    <script>
        (function() {
            try {
                var raw = localStorage.getItem('leettutor_settings');
                var s = raw ? JSON.parse(raw) : {};
                document.documentElement.setAttribute('data-theme', s.theme || 'dark');
                document.documentElement.setAttribute('data-reduced-motion', s.reducedMotion || 'system');
            } catch(e) {
                document.documentElement.setAttribute('data-theme', 'dark');
                document.documentElement.setAttribute('data-reduced-motion', 'system');
            }
        })();
    </script>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>LeetCode Tutor</h1>
            <div class="controls">
                <label for="mode-select" class="sr-only" hidden>Practice mode</label>
                <select id="mode-select">
                    <option value="learning">Learning Mode</option>
                    <option value="interview">Interview Mode</option>
                    <option value="pattern-quiz">Pattern Quiz</option>
                </select>
                <label id="enhanced-toggle" class="enhanced-toggle hidden">
                    <input type="checkbox" id="enhanced-mode-checkbox">
                    <span class="toggle-slider"></span>
                    <span class="toggle-label">Enhanced (Claude)</span>
                </label>
                <button id="reset-layout-btn" class="btn btn-secondary" title="Reset panel layout" aria-label="Reset panel layout">&#8635;</button>
                <button id="settings-btn" class="btn btn-secondary" title="Settings" aria-label="Open settings">&#9881;</button>
                <button id="new-problem-btn" class="btn btn-secondary">New Problem</button>
                <div class="random-picker-wrapper" id="random-picker-wrapper">
                    <button id="random-btn" class="btn btn-secondary" aria-haspopup="true" aria-expanded="false">Random</button>
                </div>
                <button id="history-btn" class="btn btn-secondary">History</button>
                <div id="timer" class="timer hidden" role="timer" aria-live="off">&#9201; <span id="timer-display">45:00</span></div>
            </div>
        </header>

        <nav class="panel-switcher" id="panel-switcher" aria-label="Panel navigation">
            <button class="panel-switcher-btn active" data-panel="problem">Problem</button>
            <button class="panel-switcher-btn" data-panel="editor">Editor</button>
            <button class="panel-switcher-btn" data-panel="chat">Chat</button>
            <button class="panel-switcher-btn" data-panel="draw">Draw</button>
        </nav>

        <main class="main">
            <div class="problem-panel" id="problem-panel">
                <div class="problem-header" id="problem-header">
                    <div class="problem-header-title">
                        <h2 id="problem-title">Select a Problem</h2>
                        <button id="toggle-problem" class="toggle-btn" title="Collapse problem panel" aria-label="Collapse problem panel">&#9664;</button>
                    </div>
                    <div class="problem-header-meta">
                        <span id="problem-difficulty" class="difficulty"></span>
                        <span id="problem-solved-badge" class="solved-badge hidden">&#10003; Solved <span id="solution-count" class="solution-count hidden"></span></span>
                        <button id="tts-btn" class="tts-btn hidden" title="Read aloud" aria-label="Read problem aloud">&#128266;</button>
                        <div id="tts-speed-control" class="tts-speed-control hidden">
                            <label for="tts-speed-select" class="sr-only" hidden>Reading speed</label>
                            <select id="tts-speed-select" title="Reading speed">
                                <option value="0.75">0.75x</option>
                                <option value="1" selected>1x</option>
                                <option value="1.25">1.25x</option>
                                <option value="1.5">1.5x</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div id="problem-description" class="problem-description"></div>
            </div>

            <div class="resize-handle resize-handle-h" id="problem-panel-resize" role="separator" aria-orientation="vertical"></div>

            <div class="center-panel">
                <button id="expand-problem" class="expand-problem-btn" title="Show problem panel" aria-label="Show problem panel">&#9654;</button>
                <div class="editor-section">
                    <div id="editor" class="editor" role="group" aria-label="Code editor"></div>
                </div>

                <div class="actions">
                    <button id="run-btn" class="btn btn-secondary" title="Run (Ctrl+Enter)">&#9654; Run</button>
                    <button id="submit-btn" class="btn btn-primary" title="Submit (Ctrl+Shift+Enter)">Submit</button>
                    <button id="reset-btn" class="btn btn-secondary" title="Reset code to starter">Reset</button>
                    <button id="restart-btn" class="btn btn-secondary btn-restart" title="Restart session from scratch">Restart</button>
                    <button id="hint-btn" class="btn btn-hint" title="Hint (Ctrl+H)">Hint</button>
                    <button id="zen-toggle-btn" class="btn btn-zen-toggle" title="Zen Mode (Ctrl+Shift+Z)">Zen</button>
                </div>

                <div class="resize-handle resize-handle-v" id="results-resize" role="separator" aria-orientation="horizontal"></div>
                <div id="test-results" class="test-results" role="region" aria-label="Test results"></div>

                <div id="pattern-quiz-panel" class="pattern-quiz-panel hidden">
                    <h3>What pattern solves this problem?</h3>
                    <div id="pattern-buttons" class="pattern-buttons" role="group" aria-label="Pattern choices"></div>
                    <div id="pattern-feedback" class="pattern-feedback hidden" role="status" aria-live="polite"></div>
                    <div id="pattern-explanation" class="pattern-explanation hidden"></div>
                    <div class="pattern-actions">
                        <button id="next-problem-btn" class="btn btn-primary hidden">Next Problem</button>
                        <div id="pattern-stats" class="pattern-stats" aria-live="polite"></div>
                    </div>
                </div>
            </div>

            <div class="resize-handle resize-handle-h" id="chat-panel-resize" role="separator" aria-orientation="vertical"></div>

            <div class="right-panel">
                <div id="whiteboard-section" class="whiteboard-section collapsed">
                    <div class="whiteboard-toolbar">
                        <span class="whiteboard-title">Whiteboard</span>
                        <button id="send-to-tutor-btn" class="btn btn-secondary btn-sm" title="Send drawing to tutor">Send to Tutor</button>
                        <button id="whiteboard-clear-btn" class="btn btn-secondary btn-sm" title="Clear whiteboard">Clear</button>
                        <button id="whiteboard-zen-btn" class="btn btn-zen-toggle btn-sm" title="Whiteboard Zen (Ctrl+Shift+W)">Zen</button>
                        <button id="whiteboard-toggle-btn" class="whiteboard-toggle-btn" title="Toggle whiteboard" aria-label="Toggle whiteboard">&#9650;</button>
                    </div>
                    <div id="excalidraw-root" class="excalidraw-container"></div>
                </div>
                <div class="resize-handle resize-handle-v" id="whiteboard-resize" role="separator" aria-orientation="horizontal"></div>
                <div class="chat-section">
                    <div id="ws-status" class="ws-status hidden" role="status">Reconnecting...</div>
                    <div id="chat-messages" class="chat-messages" role="log" aria-label="Chat messages" aria-live="polite"></div>
                    <div class="chat-input-container">
                        <label for="chat-input" class="sr-only" hidden>Chat message</label>
                        <textarea id="chat-input" placeholder="Ask for help, explain your thinking, or discuss your approach..." rows="3"></textarea>
                        <button id="send-btn" class="btn btn-primary">Send</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="solution-backdrop" class="drawer-backdrop"></div>
    <div id="solution-drawer" class="drawer drawer-left" role="dialog" aria-modal="true" aria-labelledby="solution-drawer-title">
        <div class="solution-drawer-header">
            <h2 id="solution-drawer-title">Saved Solutions</h2>
            <button id="close-solution-drawer" class="drawer-close-btn" title="Close" aria-label="Close solutions drawer">&times;</button>
        </div>
        <div id="solution-drawer-content" class="solution-drawer-content"></div>
    </div>

    <div id="problem-backdrop" class="drawer-backdrop"></div>
    <div id="problem-modal" class="drawer" role="dialog" aria-modal="true" aria-labelledby="problem-modal-title">
        <div class="problem-modal-header">
            <h2 id="problem-modal-title">Select a Problem</h2>
            <div class="drawer-header-actions">
                <div class="view-toggle" role="group" aria-label="View mode">
                    <button class="view-toggle-btn active" data-view="list">List</button>
                    <button class="view-toggle-btn" data-view="tree" disabled title="Coming soon">Tree</button>
                </div>
                <button id="close-modal" class="drawer-close-btn" title="Close" aria-label="Close problem drawer">&times;</button>
            </div>
        </div>
        <div class="problem-filters">
            <label for="problem-search" class="sr-only" hidden>Search problems</label>
            <input type="text" id="problem-search" placeholder="Search problems..." class="filter-search">
            <div class="filter-tabs difficulty-filters" role="group" aria-label="Difficulty filter">
                <button class="filter-tab difficulty-tab active" data-difficulty="all">All</button>
                <button class="filter-tab difficulty-tab" data-difficulty="easy">Easy</button>
                <button class="filter-tab difficulty-tab" data-difficulty="medium">Medium</button>
                <button class="filter-tab difficulty-tab" data-difficulty="hard">Hard</button>
            </div>
            <div class="filter-tabs status-filters" role="group" aria-label="Status filter">
                <button class="filter-tab status-tab active" data-status="all">All</button>
                <button class="filter-tab status-tab" data-status="solved">Solved</button>
                <button class="filter-tab status-tab" data-status="attempted">Attempted</button>
                <button class="filter-tab status-tab" data-status="unsolved">Unsolved</button>
            </div>
        </div>
        <div id="problem-list" class="problem-list" role="list"></div>
        <div id="skill-tree-root" class="skill-tree-container hidden"></div>
    </div>

    <div id="history-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="history-modal-title">
        <div class="modal-content modal-wide">
            <div class="history-header">
                <h2 id="history-modal-title">Session History</h2>
                <div class="history-tab-toggle" role="group" aria-label="History view">
                    <button class="history-tab active" data-tab="sessions">Sessions</button>
                    <button class="history-tab" data-tab="solutions">Solutions</button>
                </div>
                <button id="history-back" class="btn btn-secondary hidden">Back</button>
                <button id="close-history" class="btn btn-secondary" style="margin-left:auto">Close</button>
            </div>
            <div id="session-list" class="session-list" role="list"></div>
            <div id="session-detail" class="session-detail hidden"></div>
        </div>
    </div>

    <div id="login-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="login-modal-title">
        <div class="modal-content login-modal-content">
            <h2 id="login-modal-title">Login Required</h2>
            <p class="login-subtitle">Enter the password to access LeetCode Tutor.</p>
            <label for="login-password" class="sr-only" hidden>Password</label>
            <input type="password" id="login-password" placeholder="Password" class="filter-search login-password-input">
            <p id="login-error" class="login-error" role="alert" aria-live="assertive"></p>
            <button id="login-btn" class="btn btn-primary login-submit-btn">Login</button>
        </div>
    </div>


    <div id="settings-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="settings-modal-title">
        <div class="modal-content settings-modal-content">
            <div class="settings-header">
                <h2 id="settings-modal-title">Settings</h2>
                <button id="close-settings" class="settings-close-btn" title="Close settings" aria-label="Close settings">&times;</button>
            </div>
            <div class="settings-body">
                <div class="settings-section" data-section="appearance">
                    <button class="settings-section-header" aria-expanded="true">
                        <span>Appearance</span>
                        <span class="settings-chevron">&#9660;</span>
                    </button>
                    <div class="settings-section-content">
                        <div class="settings-row">
                            <label for="setting-theme">Theme</label>
                            <select id="setting-theme" data-setting="theme">
                                <option value="dark">Dark</option>
                                <option value="sepia">Sepia</option>
                                <option value="low-distraction">Low Distraction</option>
                            </select>
                        </div>
                        <div class="settings-row">
                            <label for="setting-editorFontSize">Editor Font Size</label>
                            <div class="settings-range-group">
                                <input type="range" id="setting-editorFontSize" data-setting="editorFontSize" min="12" max="24" step="1">
                                <span class="settings-range-value" id="setting-editorFontSize-value">14</span>
                            </div>
                        </div>
                        <div class="settings-row">
                            <label for="setting-editorFontFamily">Editor Font</label>
                            <select id="setting-editorFontFamily" data-setting="editorFontFamily">
                                <option value="default">Default</option>
                                <option value="jetbrains-mono">JetBrains Mono</option>
                                <option value="fira-code">Fira Code</option>
                                <option value="comic-mono">Comic Mono</option>
                            </select>
                        </div>
                        <div class="settings-row">
                            <label for="setting-editorLineHeight">Line Height</label>
                            <div class="settings-range-group">
                                <input type="range" id="setting-editorLineHeight" data-setting="editorLineHeight" min="1.2" max="2.0" step="0.1">
                                <span class="settings-range-value" id="setting-editorLineHeight-value">1.5</span>
                            </div>
                        </div>
                        <div class="settings-row">
                            <label for="setting-editorLigatures">Editor Ligatures</label>
                            <label class="settings-toggle">
                                <input type="checkbox" id="setting-editorLigatures" data-setting="editorLigatures">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="settings-row">
                            <label for="setting-uiFontSize">UI Font Size</label>
                            <div class="settings-range-group">
                                <input type="range" id="setting-uiFontSize" data-setting="uiFontSize" min="13" max="20" step="1">
                                <span class="settings-range-value" id="setting-uiFontSize-value">14px</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="settings-section" data-section="focus">
                    <button class="settings-section-header" aria-expanded="true">
                        <span>Focus</span>
                        <span class="settings-chevron">&#9660;</span>
                    </button>
                    <div class="settings-section-content">
                        <div class="settings-row">
                            <label for="setting-inactivityNudgeMinutes">Inactivity Nudge</label>
                            <div class="settings-range-group">
                                <input type="range" id="setting-inactivityNudgeMinutes" data-setting="inactivityNudgeMinutes" min="0" max="10" step="1">
                                <span class="settings-range-value" id="setting-inactivityNudgeMinutes-value">2 min</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="settings-section" data-section="audio">
                    <button class="settings-section-header" aria-expanded="true">
                        <span>Audio</span>
                        <span class="settings-chevron">&#9660;</span>
                    </button>
                    <div class="settings-section-content">
                        <div class="settings-row">
                            <label for="setting-ambientSound">Ambient Sound</label>
                            <select id="setting-ambientSound" data-setting="ambientSound">
                                <option value="off">Off</option>
                                <option value="brown-noise">Brown Noise</option>
                                <option value="pink-noise">Pink Noise</option>
                            </select>
                        </div>
                        <div class="settings-row">
                            <label for="setting-ambientVolume">Volume</label>
                            <div class="settings-range-group">
                                <input type="range" id="setting-ambientVolume" data-setting="ambientVolume" min="0" max="1" step="0.05">
                                <span class="settings-range-value" id="setting-ambientVolume-value">30%</span>
                            </div>
                        </div>
                        <div class="settings-row">
                            <label for="setting-earcons">Earcons</label>
                            <label class="settings-toggle">
                                <input type="checkbox" id="setting-earcons" data-setting="earcons">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="settings-row">
                            <label for="setting-earconVolume">Earcon Volume</label>
                            <div class="settings-range-group">
                                <input type="range" id="setting-earconVolume" data-setting="earconVolume" min="0" max="1" step="0.05">
                                <span class="settings-range-value" id="setting-earconVolume-value">30%</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="settings-section" data-section="accessibility">
                    <button class="settings-section-header" aria-expanded="true">
                        <span>Accessibility</span>
                        <span class="settings-chevron">&#9660;</span>
                    </button>
                    <div class="settings-section-content">
                        <div class="settings-row">
                            <label for="setting-reducedMotion">Reduced Motion</label>
                            <select id="setting-reducedMotion" data-setting="reducedMotion">
                                <option value="system">System Default</option>
                                <option value="on">On</option>
                                <option value="off">Off</option>
                            </select>
                        </div>
                        <div class="settings-row">
                            <label for="setting-confirmDestructive">Confirm Destructive Actions</label>
                            <label class="settings-toggle">
                                <input type="checkbox" id="setting-confirmDestructive" data-setting="confirmDestructive">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="settings-footer">
                <button id="settings-reset-all" class="btn btn-secondary">Reset All to Defaults</button>
            </div>
        </div>
    </div>

    <div id="resume-dialog" class="resume-dialog hidden" role="dialog" aria-modal="true" aria-labelledby="resume-dialog-title">
        <div class="resume-dialog-content">
            <p id="resume-dialog-title"><strong>Resume previous session?</strong></p>
            <p id="resume-dialog-text"></p>
            <p id="resume-dialog-mode" class="resume-dialog-mode"></p>
            <div class="resume-dialog-buttons">
                <button id="resume-dialog-resume" class="btn btn-primary">Resume Session</button>
                <button id="resume-dialog-fresh" class="btn btn-secondary">Start Fresh</button>
            </div>
        </div>
    </div>

    <div id="zen-status-bar" class="zen-status-bar hidden" role="toolbar" aria-label="Zen mode controls">
        <span id="zen-problem-title" class="zen-problem-title">No problem selected</span>
        <div class="zen-status-actions zen-editor-actions">
            <button id="zen-run-btn" class="btn btn-secondary btn-sm" title="Run (Ctrl+Enter)">Run</button>
            <button id="zen-submit-btn" class="btn btn-primary btn-sm" title="Submit (Ctrl+Shift+Enter)">Submit</button>
            <button id="zen-hint-btn" class="btn btn-hint btn-sm" title="Hint">Hint</button>
            <span id="zen-timer" class="zen-timer hidden"><span id="zen-timer-display"></span></span>
            <button id="zen-exit-btn" class="btn btn-secondary btn-sm" title="Exit Zen Mode (Ctrl+Shift+Z)">Exit Zen</button>
        </div>
        <div class="zen-status-actions zen-whiteboard-actions hidden">
            <button id="zen-wb-send-btn" class="btn btn-primary btn-sm" title="Send drawing to tutor">Send to Tutor</button>
            <button id="zen-wb-clear-btn" class="btn btn-secondary btn-sm" title="Clear whiteboard">Clear</button>
            <button id="zen-wb-exit-btn" class="btn btn-secondary btn-sm" title="Exit Whiteboard Zen (Ctrl+Shift+W)">Exit Zen</button>
        </div>
    </div>

    <div id="confirm-dialog-overlay" class="confirm-dialog-overlay hidden">
        <div class="confirm-dialog" role="dialog" aria-modal="true" aria-labelledby="confirm-dialog-title">
            <h3 id="confirm-dialog-title" class="confirm-dialog-title">Are you sure?</h3>
            <p id="confirm-dialog-message" class="confirm-dialog-message"></p>
            <p id="confirm-dialog-detail" class="confirm-dialog-detail"></p>
            <div class="confirm-dialog-buttons">
                <button id="confirm-dialog-cancel" class="btn btn-primary">Cancel</button>
                <button id="confirm-dialog-confirm" class="btn btn-secondary">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Ticket 32: Streak Display -->
    <div id="streak-display" class="streak-display hidden">
        <button id="streak-badge" class="streak-badge" title="View streak details" aria-label="View streak details">
            <span class="streak-fire">&#128293;</span>
            <span id="streak-count" class="streak-count">0</span>
            <span class="streak-label">day streak</span>
            <span id="streak-freeze-badge" class="streak-freeze-badge hidden">&#10052; <span id="streak-freeze-count">0</span></span>
        </button>
    </div>

    <!-- Ticket 32: Streak Detail Popover -->
    <div id="streak-popover" class="streak-popover hidden" role="dialog" aria-label="Practice streak details">
        <div class="streak-popover-content">
            <div class="streak-popover-header">
                <h3>Practice Streak</h3>
                <button id="streak-popover-close" class="streak-popover-close" title="Close streak details" aria-label="Close streak details">&times;</button>
            </div>
            <div class="streak-stats-row">
                <div class="streak-stat">
                    <span class="streak-stat-value" id="streak-current-val">0</span>
                    <span class="streak-stat-label">Current</span>
                </div>
                <div class="streak-stat">
                    <span class="streak-stat-value" id="streak-longest-val">0</span>
                    <span class="streak-stat-label">Longest</span>
                </div>
                <div class="streak-stat">
                    <span class="streak-stat-value" id="streak-freezes-val">0</span>
                    <span class="streak-stat-label">Freezes &#10052;</span>
                </div>
            </div>
            <div id="streak-calendar" class="streak-calendar"></div>
            <div id="streak-repair-info" class="streak-repair-info hidden"></div>
        </div>
    </div>

    <!-- Ticket 32: Streak Repair Banner -->
    <div id="streak-repair-banner" class="streak-repair-banner hidden" role="alert"></div>

    <!-- Ticket 32: Streak Milestone Toast -->
    <div id="streak-milestone-toast" class="streak-milestone-toast hidden" role="status" aria-live="polite"></div>

    <div id="solution-viewer-overlay" class="solution-viewer-overlay hidden"></div>

    <script type="module" src="/app.js"></script>
    <script type="module" src="/src/excalidraw-island.jsx"></script>
    <script type="module" src="/src/skill-tree-island.jsx"></script>
</body>
</html>
